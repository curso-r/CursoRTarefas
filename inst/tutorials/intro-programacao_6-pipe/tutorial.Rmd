---
title: "Tarefas: Pipe"
description: "Exercícios do curso 'Introdução à programação com R'"
encoding: "UTF-8"
output: 
  learnr::tutorial:
    language: 
      pt: 
        button: 
          submitanswer: "Avaliar resposta"
    progressive: true
    allow_skip: true
    theme: yeti
runtime: shiny_prerendered
params:
  url_form: "https://docs.google.com/forms/d/e/1FAIpQLSevSTfvWHdJCxFlsCpgzvyZw4jTQXykljdITdZhuYl6R5BLrQ/viewform"
---

```{r setup, include=FALSE}
# remotes::install_github("curso-r/CursoRTarefas")
library(CursoRTarefas)
CursoRTarefas::adicionar_chunk_setup() 
```

```{r results='asis', message = FALSE}
CursoRTarefas::adicionar_codigo_pre_tutorial(curso = "Introdução à programação com R",
                              url = "https://loja.curso-r.com/introduc-o-a-programac-o-com-r.html")
```

## Pipe

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(dplyr) # carregando o pacote dplyr para usar 
# as funções filter e select

library(magrittr) # carregando o pacote que contém o pipe %>% 


airquality
``` 


1) O código a seguir foi apresentado em um exercício na tarefa 3-filtros, onde era necessário selecionar as colunas Solar.R, Month e Day, e filtrar as linhas que não apresentassem NA na coluna Solar.R.

Adapte esse código para usar o pipe (do pacote `magrittr`), sem salvar nada em objetos:

```{r pipe-tidyverse-i, exercise = TRUE}
airquality_selecao <- select(airquality, Solar.R, Month, Day)
airquality_filtrado <- filter(airquality_selecao, !is.na(Solar.R))
airquality_filtrado
```

```{r pipe-tidyverse-i-hint}
airquality %>% 
  select(____) %>% 
  filter(____)
```

```{r pipe-tidyverse-i-solution}
airquality %>% 
  select(Solar.R, Month, Day) %>% 
  filter(!is.na(Solar.R))
```

```{r pipe-tidyverse-i-check}
gradethisBR::grade_this_code()
```


2) Se quisermos calcular a média da variável Ozone, para o mês de junho, e arredondar o resultado para duas casas decimais, podemos usar o seguinte código em R base:

```{r echo=TRUE}
round(mean(airquality[airquality$Month == 6,]$Ozone, na.rm = TRUE), 2)
```
É confuso entender o que acontece pois lemos de "dentro pra fora". 

Com o pipe conseguimos escrever este mesmo código de uma forma mais legível.

Reescreva a lógica do código acima usando pipe (verifique também se o resultado é igual): 

```{r pipe-tidyverse-ii, exercise = TRUE}
airquality %>% 
  #_____(______) %>% 
  pull(Ozone) %>% # a função pull(), do pacote dplyr, retorna a coluna
  # como um vetor
  #____(na.rm = TRUE) %>% 
  #_____(_)
```

```{r pipe-tidyverse-ii-hint}
airquality %>% 
  filter(______) %>% 
  pull(Ozone) %>% 
  mean(na.rm = TRUE) %>% 
  round(_)
```

```{r pipe-tidyverse-ii-solution}
airquality %>% 
  filter(Month == 6) %>% 
  pull(Ozone) %>% 
  mean(na.rm = TRUE) %>% 
  round(2)
```

```{r pipe-tidyverse-ii-check}
gradethisBR::grade_this_code()
```



3) Nesse exercício, voltaremos no desafio apresentado na tarefa 2, sobre tabelas. Naquele desafio, mostramos como calcular o desvio padrão.

```{r pipe-tidyverse-iii-exemplo, echo=TRUE, exercise = TRUE}
media_ozone <- mean(airquality$Ozone, na.rm = TRUE)
ozone_centralizado <- airquality$Ozone - media_ozone
ozone_centralizado_ao_quadrado <-  ozone_centralizado ^ 2
media_ozone_centralizado_ao_quadrado <- mean(ozone_centralizado_ao_quadrado, na.rm = TRUE)
desvio_padrao_ozone_calculado <- sqrt(media_ozone_centralizado_ao_quadrado)
desvio_padrao_ozone_calculado
```


Agora vamos adaptar esse código para usar com pipe. Antes disso, também iremos criar funções para usar nesse encadeamento:

a) Crie uma função chamada `centralizar`, que recebe um argumento chamado `vetor_centralizar`, e retorna o vetor centralizado (vetor - média do vetor).

b) Crie uma função chamada `eleva_ao_quadrado`, que recebe um argumento chamado `x`, e retorna o valor de x elevado ao quadrado.

c) Usando as funções criadas e o pipe, reescreva o código para calcular o desvio padrão:

```{r pipe-tidyverse-iii, exercise = TRUE,  echo=FALSE}
# a) 
centralizar <- function(vetor_centralizar){
  _____
}

# b)
eleva_ao_quadrado <- function(x){
  _____
}

# c) 
airquality$Ozone %>% 
  ___ %>% 
  ___ %>% 
  ___ %>% 
  ___()
  
  
  
  
```

```{r pipe-tidyverse-iii-hint-1,  echo=FALSE}
# a) 
centralizar <- function(vetor_centralizar){
  vetor_centralizar - mean(vetor_centralizar, na.rm = TRUE) 
}

# b)
eleva_ao_quadrado <- function(x){
  _____
}

# c) 
airquality$Ozone %>% 
  ___ %>% 
  ___ %>% 
  ___ %>% 
  ___()
  
```

```{r pipe-tidyverse-iii-hint-2,  echo=FALSE}
# a) 
centralizar <- function(vetor_centralizar){
  vetor_centralizar - mean(vetor_centralizar, na.rm = TRUE) 
}

# b)
eleva_ao_quadrado <- function(x){
  x ^ 2 
}

# c) 
airquality$Ozone %>% 
  ___ %>% 
  ___ %>% 
  ___ %>% 
  ___()
  
```


```{r pipe-tidyverse-iii-hint-3,  echo=FALSE}
# a) 
centralizar <- function(vetor_centralizar){
  vetor_centralizar - mean(vetor_centralizar, na.rm = TRUE) 
}

# b)
eleva_ao_quadrado <- function(x){
  x ^ 2 
}

# c) 
airquality$Ozone %>% 
  centralizar() %>% 
  eleva_ao_quadrado() %>% 
  ___(na.rm = TRUE) %>% 
  ___()
```

```{r pipe-tidyverse-iii-solution,  echo=FALSE}
# a) 
centralizar <- function(vetor_centralizar){
  vetor_centralizar - mean(vetor_centralizar, na.rm = TRUE) 
}

# b)
eleva_ao_quadrado <- function(x){
  x ^ 2 
}

# c) 
airquality$Ozone %>% 
  centralizar() %>% 
  eleva_ao_quadrado() %>% 
  mean(na.rm = TRUE) %>% 
  sqrt()
```

```{r pipe-tidyverse-iii-check}
grade_this({
  if (identical(.result, .solution)) {
    pass("Correto!")
  }
  fail()
})
```


## Enviar as respostas

Se você completou a tarefa e quer submeter, clique no botão abaixo ('Generate') para gerar o seu código hash e envie usando o formulário a seguir:

```{r context="server"}
learnrhash::encoder_logic()
```

```{r encode, echo=FALSE}
learnrhash::encoder_ui(ui_before = " ", ui_after = " ")
```

```{r results='asis'}
CursoRTarefas::adicionar_codigo_pos_tutorial(url_form = params$url_form)
```

